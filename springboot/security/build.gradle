plugins {
  id "org.flywaydb.flyway"
}

springBoot {
  mainClass = "alvin.study.springboot.security.Main"
}

bootJar {
  exclude "META-INF/*.SF", "META-INF/*.DSA", "META-INF/*.RSA", "META-INF/*.MF"

  manifest {
    attributes "Implementation-Title": "Study Spring Boot Security"
    attributes "Implementation-Version": projectVersion.version
  }

  archiveBaseName = project.group
  archiveFileName = "alvin.study.springboot-security.${archiveExtension.get()}"
}

flyway {
  url = "jdbc:h2:${projectDir}/.data/dev;MODE=MYSQL"
  user = "dev"
  password = "password"
  locations = [
    "filesystem:${projectDir}/src/main/resources/migration"
  ]
  table = "schema_version"
}

dependencies {
  implementation "org.springframework.boot:spring-boot-starter-security",
                 "org.springframework.boot:spring-boot-starter-web",
                 "org.springframework.boot:spring-boot-starter-jdbc",
                 "org.springframework.boot:spring-boot-starter-validation",
                 "org.springframework.boot:spring-boot-starter-data-redis",
                 "com.baomidou:mybatis-plus-jsqlparser:${VER_MYBATIS_PLUS}",
                 "com.auth0:java-jwt:${VER_AUTH0_JWT}",
                 "org.apache.commons:commons-pool2:${VER_COMMONS_POOL2}",
                 "commons-codec:commons-codec:${VER_COMMONS_CODEC}",
                 "org.modelmapper:modelmapper:${VER_MODELMAPPER}",
                 "com.h2database:h2:${VER_H2_DB}"
  implementation ("com.baomidou:mybatis-plus-spring-boot3-starter:${VER_MYBATIS_PLUS}") {
    exclude group: "org.springframework.boot", module: "*"
  }
  implementation ("com.auth0:java-jwt:${VER_AUTH0_JWT}") {
    exclude group: "com.fasterxml.jackson.core", module: "*"
  }
  runtimeOnly "org.flywaydb:flyway-core:${VER_FLYWAY}"
  testImplementation "org.springframework.boot:spring-boot-starter-webflux",
                     "org.springframework.security:spring-security-test:${VER_SPRING_SECURITY_TEST}"
}
